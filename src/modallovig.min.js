/*
**  Author  : Saeed Hassanpour 
**  Company : Parto Pardazesh Fartak(IRANAPEX)- http://iranapex.ir
**  Date    : 2017/06
**  Version : 1.0
*/
!function(){var model,record$,value,idRegion$,ig$,view$,th$,modalObj$,ajaxIdentifier$,clearCheck,returnCheck$,columnsmap$,countRun$=0,openMLovIG={makeDialogUrl:function(url,args){var i,_temp;if(th$=this,url=url.replace(/\\u(\d\d\d\d)/g,function(e,a){return String.fromCharCode(parseInt(a,16))}),args){var _temp=new Array;for(_temp=args.split(","),args=_temp||[],i=0;i<args.length;i++)url=-1!=encodeURIComponent(args[i]).indexOf("%23",0)?url.replace("%24"+i+"%24",th$.getIgValue(encodeURIComponent(args[i]).replace(/%23/g,""))):encodeURIComponent(args[i]).indexOf("%24v",0)>-1?url.replace("%24"+i+"%24",eval(args[i])):url.replace("%24"+i+"%24",encodeURIComponent(args[i]))}return url},getIgValue:function(e){return"grid"===view$.internalIdentifier&&(model=view$.model,(record$=view$.getSelectedRecords()).forEach(function(a,t){"object"==typeof(value=model.getValue(record$[t],e))&&(value=value.v)})),value},setIgValue:function(pData,pReturn){if(columnsmap$){var result$,itemsMapping=columnsmap$;itemReturns=itemsMapping.substr(0,itemsMapping.indexOf(":")),itemsMap=itemsMapping.substr(itemsMapping.indexOf(":")+1),returnCheck$=pReturn,openlov$=!0,th$=this;var temp=new Array;temp=itemReturns.split(","),itemReturns=temp||[],temp=itemsMap.split(","),itemsMap=temp||[],apex.debug.log("Modal Lov IG [itemReturns]: "+itemReturns),apex.debug.log("Modal Lov IG [itemsMap]: "+itemsMap),record$.forEach(function(object,index){for(i=0;i<itemReturns.length;i++)1==returnCheck$?(result$=eval("pData."+encodeURIComponent(itemReturns[i])),apex.debug.log("Modal Lov IG ["+encodeURIComponent(itemsMap[i])+"]: "+result$),model.setValue(record$[index],encodeURIComponent(itemsMap[i]),result$)):1==th$.getClearCheck()&&pReturn!=encodeURIComponent(itemsMap[i])&&model.setValue(record$[index],encodeURIComponent(itemsMap[i]),"")})}th$.setclearCheck(!1),returnCheck$=!1},clearItemIg:function(e,a){(th$=this).setclearCheck(!0),e&&!a&&record$.forEach(function(a,t){model.setValue(record$[t],e,"")}),columnsmap$&&th$.setIgValue(null,e),th$.setclearCheck(!1)},setclearCheck:function(e){clearCheck=e},getClearCheck:function(){return clearCheck},setAjaxIdentifier:function(e,a){ajaxIdentifier$="open"==a?e.target.nextElementSibling.firstElementChild.nextElementSibling.innerText:"change"==a?e.target.nextElementSibling.nextElementSibling.firstElementChild.nextElementSibling.innerText:e.target.innerText,ajaxIdentifier$=ajaxIdentifier$.replace(/["']/g,"")},setRegionIG:function(e){var a=apex.region.findClosest(e.target);a&&(idRegion$=a.element[0].attributes[1].nodeValue,ig$=apex.region(idRegion$).widget(),view$=ig$.interactiveGrid("getViews",ig$.interactiveGrid("getCurrentViewId")),model=view$.model,record$=view$.getSelectedRecords(),apex.debug.log("Modal Lov IG [Current record]: "+record$))},ajaxCall:function(e,a,t){th$.setAjaxIdentifier(e,a),th$.setRegionIG(e),apex.server.plugin(ajaxIdentifier$,{x01:"GET_COLS_MAP"},{success:function(n){n.success&&(columnsmap$=n.modalcolsmap,"clear"==a?(_colName=e.target.id,_colName=_colName.substr(_colName.indexOf("_")+1)):_colName=e.target.dataset.id,th$.clearItemIg(_colName,t))},error:function(e,a){apex.debug.trace("Modal Lov IG - ajaxCall[GET_COLS_MAP =>Error]: ",a)}})},_init_event_modallov:function(pData,pAjaxId){th$=this,returnCheck$=!1,th$.setclearCheck(!1),countRun$+=1;var _ajaxids="";apex.debug.log("Modal Lov IG [ModalItem=>"+countRun$+"]: "+pData);var jsonData$=JSON.parse(pData);if(jsonData$.cascadeCols){var _ajaxids,_temp=new Array;for(_temp=jsonData$.cascadeCols.split(","),_temp=_temp||[],i=0;i<_temp.length;i++)_ajaxids=$("#C"+_temp[i]).attr("data-ajaxid"),_ajaxids=_ajaxids+","+pAjaxId,_ajaxids=_ajaxids.replace(/^undefined,?/,""),$("#C"+_temp[i]).attr("data-ajaxid",_ajaxids),$("#C"+_temp[i]).bind("change",function(e){parent=$(e.target),currentigID=$(e.target).parents("div.a-IG").attr("id"),_spanClear=$(e.target).closest("div#"+currentigID).find("button.ig-lov-clear"),$(_spanClear).each(function(a){_ajaxids=$("#"+e.target.id).data("ajaxid");var t=new Array;for(t=(t=_ajaxids.split(","))||[],i=0;i<t.length;i++)t[i]==$(_spanClear)[a].innerText&&(_buttonClear=$('span:contains("'+$(_spanClear)[a].innerText+'")').closest("button.ig-lov-clear"),_buttonClear&&_buttonClear.trigger("click"))})})}1==countRun$&&($(".ig-lov-clear").bind("click",function(e){$(".ig-lov-clear").prop("disabled",!0),setTimeout(function(){$(".ig-lov-clear").prop("disabled",!1)},500),th$.ajaxCall(e,"clear",!1)}),$(".ig-modal-lov").bind("change",function(e){1!=returnCheck$&&1!=th$.getClearCheck()&&(th$.setRegionIG(e),th$.ajaxCall(e,"change",!0))}),$(".ig-lov-open").dblclick(function(e){return e.stopPropagation(),e.preventDefault(),!1}),$(".ig-lov-open").bind("click",function(event){$(".ig-lov-open").prop("disabled",!0),setTimeout(function(){$(".ig-lov-open").prop("disabled",!1)},500);var _modalurl,_modallovvalues;th$.setAjaxIdentifier(event,"open"),th$.setRegionIG(event),apex.server.plugin(ajaxIdentifier$,{x01:"PREPARE_URL"},{success:function(pData){if(pData.success){columnsmap$=pData.modalcolsmap,_modalurl=pData.openmodal,_modallovvalues=pData.modallovvalues,apex.debug.log("Modal Lov IG [PREPARE_URL-columnsmap]: "+columnsmap$);var modalurlIG=th$.makeDialogUrl(_modalurl,_modallovvalues);apex.server.plugin(ajaxIdentifier$,{x01:modalurlIG,x02:idRegion$},{success:function(pData){pData.success&&(apex.debug.log("Modal Lov IG [PREPARE_URL-openmodal]: "+pData.openmodal),apex.debug.log("Modal Lov IG [Dialog_html_exp]: "+pData.modalhtmlexp),apex.debug.log("Modal Lov IG [Dialog_Row Clicked]: "+pData.modalscriptdig),eval(pData.openmodal))},error:function(e,a){apex.debug.trace("Modal Lov IG - apex.server.plugin:open click(inner) => Error:",a)}})}},error:function(e,a){apex.debug.trace("Modal Lov IG - apex.server.plugin:open click => Error:",a)}})}))}};window.openMLovIG=openMLovIG}(apex.jQuery);